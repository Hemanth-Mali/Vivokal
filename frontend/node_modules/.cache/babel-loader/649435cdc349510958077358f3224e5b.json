{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Hemanth/Desktop/Vivokal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Hemanth/Desktop/Vivokal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/Hemanth/Desktop/Vivokal/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import axios from'axios';import{PayPalButton}from'react-paypal-button-v2';import{Link}from'react-router-dom';import{Row,Col,Image,ListGroup,Card,Button}from'react-bootstrap';import Meta from'../components/Meta';import{useDispatch,useSelector}from'react-redux';import Message from'../components/Message';import Loader from'../components/Loader';import{getOrderDetails,payOrder,deliverOrder}from'../actions/orderActions';import{ORDER_PAY_RESET,ORDER_DELIVER_RESET}from'../constants/orderConstants';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var OrdersScreens=function OrdersScreens(_ref){var match=_ref.match,history=_ref.history;var orderId=match.params.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),sdkReady=_useState2[0],setSdkReady=_useState2[1];var dispatch=useDispatch();var orderDetails=useSelector(function(state){return state.orderDetails;});var order=orderDetails.order,loading=orderDetails.loading,error=orderDetails.error;var orderPay=useSelector(function(state){return state.orderPay;});var loadingPay=orderPay.loading,successPay=orderPay.success;var orderDeliver=useSelector(function(state){return state.orderDeliver;});var loadingDeliver=orderDeliver.loading,successDeliver=orderDeliver.success;var userLogin=useSelector(function(state){return state.userLogin;});var userInfo=userLogin.userInfo;if(!loading){var addDecimals=function addDecimals(num){return(Math.round(num*100)/100).toFixed(2);};//Calculating Prices\norder.itemsPrice=addDecimals(order.orderItems.reduce(function(acc,item){return acc+item.price*item.qty;},0));order.totalPrice=addDecimals(order.totalPrice);order.shippingPrice=addDecimals(order.shippingPrice);order.taxPrice=addDecimals(order.taxPrice);}useEffect(function(){if(!userInfo){history.push('/login');}var addPayPalScript=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$axios$get,clientId,script;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/api/config/paypal');case 2:_yield$axios$get=_context.sent;clientId=_yield$axios$get.data;script=document.createElement('script');script.type='text/javascript';script.src=\"https://www.paypal.com/sdk/js?client-id=\".concat(clientId);script.async=true;script.onload=function(){setSdkReady(true);};document.body.appendChild(script);case 10:case\"end\":return _context.stop();}}},_callee);}));return function addPayPalScript(){return _ref2.apply(this,arguments);};}();if(!order||order._id!==orderId||successPay||successDeliver){dispatch({type:ORDER_PAY_RESET});dispatch({type:ORDER_DELIVER_RESET});dispatch(getOrderDetails(orderId));}else if(!order.isPaid){if(!window.paypal){addPayPalScript();}else{setSdkReady(true);}}},[dispatch,order,orderId,successPay,successDeliver,history,userInfo]);var successPaymentHandler=function successPaymentHandler(paymentResult){console.log(paymentResult);dispatch(payOrder(orderId,paymentResult));};var deliverHandler=function deliverHandler(){dispatch(deliverOrder(order));};return loading?/*#__PURE__*/_jsx(Loader,{}):error?/*#__PURE__*/_jsx(Message,{varaint:\"danger\",children:error}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Meta,{title:\"Order\"}),/*#__PURE__*/_jsxs(\"h1\",{children:[\"Order \",order._id]}),/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:8,children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Shipping\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Name:\"}),\" \",order.user.name]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Email:\"}),/*#__PURE__*/_jsxs(\"a\",{href:\"mailto:\".concat(order.user.email),children:[\" \",order.user.email]})]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Address:\"}),order.shippingAddress.address,\",\",order.shippingAddress.city,\",\",' ',order.shippingAddress.pincode,\",\",' ',order.shippingAddress.country]}),order.isDelivered?/*#__PURE__*/_jsxs(Message,{varaint:\"success\",children:[\"Delivered on \",order.deliveredAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Delivered\"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Method: \"}),order.paymentMethod]}),order.isPaid?/*#__PURE__*/_jsxs(Message,{varaint:\"success\",children:[\"Paid on \",order.paidAt]}):/*#__PURE__*/_jsx(Message,{variant:\"danger\",children:\"Not Paid\"})]}),/*#__PURE__*/_jsxs(ListGroup.Item,{children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Order Items\"}),order.orderItems.length===0?/*#__PURE__*/_jsx(Message,{children:\"Order is Empty.\"}):/*#__PURE__*/_jsx(ListGroup,{variant:\"flush\",children:order.orderItems.map(function(item,index){return/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{md:1,children:/*#__PURE__*/_jsx(Image,{src:item.image,alt:item.name,fluid:true,rounded:true})}),/*#__PURE__*/_jsx(Col,{children:/*#__PURE__*/_jsx(Link,{to:\"/product/\".concat(item.product),children:item.name})}),/*#__PURE__*/_jsxs(Col,{md:4,children:[item.qty,\" x \\u20B9\",item.price,\" = \\u20B9\",item.qty*item.price]})]})},index);})})]})]})}),/*#__PURE__*/_jsx(Col,{md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(ListGroup,{variant:\"flush\",children:[/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(\"h2\",{children:\"Order Summary\"})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Items\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9 \",order.itemsPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Shipping\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9 \",order.shippingPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Tax\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9 \",order.taxPrice]})]})}),/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsxs(Row,{children:[/*#__PURE__*/_jsx(Col,{children:\"Total\"}),/*#__PURE__*/_jsxs(Col,{children:[\"\\u20B9 \",order.totalPrice]})]})}),!order.isPaid&&/*#__PURE__*/_jsxs(ListGroup.Item,{children:[loadingPay&&/*#__PURE__*/_jsx(Loader,{}),!sdkReady?/*#__PURE__*/_jsx(Loader,{}):/*#__PURE__*/_jsx(PayPalButton,{amount:order.totalPrice,onSuccess:successPaymentHandler})]}),loadingDeliver&&/*#__PURE__*/_jsx(Loader,{}),userInfo&&userInfo.isAdmin&&order.isPaid&&!order.isDelivered&&/*#__PURE__*/_jsx(ListGroup.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"button\",className:\"btn btn-block\",onClick:deliverHandler,children:\"Mark as Delivered\"})})]})})})]})]});};export default OrdersScreens;","map":{"version":3,"sources":["C:/Users/Hemanth/Desktop/Vivokal/frontend/src/screens/OrderScreens.js"],"names":["React","useState","useEffect","axios","PayPalButton","Link","Row","Col","Image","ListGroup","Card","Button","Meta","useDispatch","useSelector","Message","Loader","getOrderDetails","payOrder","deliverOrder","ORDER_PAY_RESET","ORDER_DELIVER_RESET","OrdersScreens","match","history","orderId","params","id","sdkReady","setSdkReady","dispatch","orderDetails","state","order","loading","error","orderPay","loadingPay","successPay","success","orderDeliver","loadingDeliver","successDeliver","userLogin","userInfo","addDecimals","num","Math","round","toFixed","itemsPrice","orderItems","reduce","acc","item","price","qty","totalPrice","shippingPrice","taxPrice","push","addPayPalScript","get","clientId","data","script","document","createElement","type","src","async","onload","body","appendChild","_id","isPaid","window","paypal","successPaymentHandler","paymentResult","console","log","deliverHandler","user","name","email","shippingAddress","address","city","pincode","country","isDelivered","deliveredAt","paymentMethod","paidAt","length","map","index","image","product","isAdmin"],"mappings":"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","sourcesContent":["import React ,{useState,useEffect} from 'react'\r\nimport axios from 'axios'\r\nimport {PayPalButton} from 'react-paypal-button-v2'\r\nimport {Link} from 'react-router-dom'\r\nimport {Row,Col,Image,ListGroup,Card,Button} from 'react-bootstrap'\r\nimport Meta from '../components/Meta'\r\nimport {useDispatch,useSelector} from 'react-redux'\r\nimport Message from '../components/Message'\r\nimport Loader from '../components/Loader'\r\nimport {getOrderDetails, payOrder,deliverOrder} from '../actions/orderActions'\r\nimport {ORDER_PAY_RESET,ORDER_DELIVER_RESET} from '../constants/orderConstants'\r\nconst OrdersScreens = ({match,history}) => {\r\n      const orderId = match.params.id \r\n\r\n      const [sdkReady, setSdkReady]= useState(false)\r\n\r\n      const dispatch = useDispatch()\r\n \r\n   \r\n    const orderDetails= useSelector(state=> state.orderDetails)\r\n    const {order,loading,error}= orderDetails \r\n\r\n    const orderPay= useSelector(state=> state.orderPay)\r\n    const {loading:loadingPay,success:successPay}= orderPay\r\n    \r\n    const orderDeliver= useSelector(state=> state.orderDeliver)\r\n    const {loading:loadingDeliver,success:successDeliver}= orderDeliver \r\n\r\n    const userLogin= useSelector(state=> state.userLogin)\r\n    const {userInfo}= userLogin\r\n\r\n      if(!loading){\r\n        const addDecimals=(num) =>{\r\n            return (Math.round(num*100)/100).toFixed(2)\r\n        }\r\n    \r\n        //Calculating Prices\r\n    \r\n        order.itemsPrice= addDecimals(order.orderItems.reduce((acc,item)=> acc+(item.price *item.qty),0))\r\n        order.totalPrice= addDecimals(order.totalPrice)\r\n        order.shippingPrice=addDecimals(order.shippingPrice)\r\n        order.taxPrice= addDecimals(order.taxPrice)\r\n      }\r\n\r\n\r\n     useEffect(() =>{\r\n\r\n        if(!userInfo){\r\n            history.push('/login')\r\n        }\r\n\r\n        const addPayPalScript= async() =>{\r\n\r\n            const { data: clientId}= await axios.get('/api/config/paypal')\r\n            const script= document.createElement('script')\r\n            script.type= 'text/javascript'\r\n            script.src= `https://www.paypal.com/sdk/js?client-id=${clientId}`\r\n            script.async = true\r\n            script.onload= () =>{\r\n                setSdkReady(true)\r\n            }\r\n             document.body.appendChild(script)\r\n        }\r\n\r\n        \r\n\r\n        if(!order ||order._id!== orderId || successPay || successDeliver){\r\n           dispatch({type: ORDER_PAY_RESET})\r\n           dispatch({type: ORDER_DELIVER_RESET})\r\n           dispatch(getOrderDetails(orderId))\r\n        } else if(!order.isPaid){\r\n            if(!window.paypal){\r\n                addPayPalScript()\r\n            } else{\r\n                setSdkReady(true)\r\n            }\r\n        }\r\n     },[dispatch,order,orderId,successPay,successDeliver,history,userInfo])\r\n   \r\n     const successPaymentHandler= (paymentResult) =>{\r\n           console.log(paymentResult)\r\n           dispatch(payOrder(orderId,paymentResult))\r\n     }\r\n    \r\n     const deliverHandler = () =>{\r\n         dispatch(deliverOrder(order))\r\n     }\r\n\r\n\r\n    return loading? <Loader />: error? <Message varaint='danger'>{error}\r\n    </Message>: <> \r\n          <Meta title='Order' />\r\n         <h1>Order {order._id}</h1>\r\n         <Row>\r\n                <Col md={8}>\r\n                    <ListGroup variant='flush'>\r\n                        <ListGroup.Item>\r\n                            <h2>Shipping</h2>\r\n                            <p>\r\n                                <strong>Name:</strong> {order.user.name}\r\n                            </p>\r\n                            <p>\r\n                            <strong>Email:</strong>\r\n                            <a href={`mailto:${order.user.email}`}> {order.user.email}</a></p>                \r\n\r\n                            <p>\r\n                                <strong>Address:</strong>\r\n                                {order.shippingAddress.address},{order.shippingAddress.city},{' '}{order.shippingAddress.pincode},{' '}\r\n                                {order.shippingAddress.country}\r\n                            </p>\r\n                            {order.isDelivered ? (<Message varaint='success'>Delivered on {order.deliveredAt}</Message>):(\r\n                                <Message variant='danger'>Not Delivered</Message>\r\n                            )}\r\n                        </ListGroup.Item>\r\n                        <ListGroup.Item>\r\n                            <h2>Payment Method</h2>\r\n                            <p>\r\n                            <strong>Method: </strong>\r\n                            {order.paymentMethod}\r\n                            </p>\r\n                            {order.isPaid ? (<Message varaint='success'>Paid on {order.paidAt}</Message>):(\r\n                                <Message variant='danger'>Not Paid</Message>\r\n                            )}\r\n                        </ListGroup.Item> \r\n                        <ListGroup.Item>\r\n                            <h2>Order Items</h2>\r\n                            {order.orderItems.length===0? <Message>Order is Empty.</Message>:(\r\n                                <ListGroup variant='flush'>\r\n                                    {order.orderItems.map((item,index)=> (\r\n                                        <ListGroup.Item key={index}>\r\n                                            <Row>\r\n                                                <Col md={1}>\r\n                                                    <Image src={item.image} alt={item.name} fluid rounded />\r\n                                                </Col>\r\n                                                <Col>\r\n                                                    <Link to={`/product/${item.product}`}>\r\n                                                        {item.name}\r\n                                                    </Link>\r\n                                                </Col>\r\n                                                <Col md={4}>\r\n                                                    {item.qty} x ₹{item.price} = ₹{item.qty * item.price}\r\n                                                </Col>\r\n                                            </Row>\r\n                                        </ListGroup.Item>\r\n                                    ))}\r\n                                </ListGroup>\r\n                            )}\r\n                        </ListGroup.Item>\r\n                    </ListGroup>\r\n                </Col>\r\n\r\n                 <Col md={4}>\r\n                     <Card>\r\n                         <ListGroup variant='flush'>\r\n\r\n                           <ListGroup.Item>\r\n                               <h2>Order Summary</h2>\r\n                           </ListGroup.Item>\r\n                           <ListGroup.Item>\r\n                               <Row>\r\n                                   <Col>Items</Col>\r\n                                   <Col>₹ {order.itemsPrice}</Col>\r\n                               </Row>\r\n                           </ListGroup.Item>\r\n                           <ListGroup.Item>\r\n                               <Row>\r\n                                   <Col>Shipping</Col>\r\n                                   <Col>₹ {order.shippingPrice}</Col>\r\n                               </Row>\r\n                           </ListGroup.Item>\r\n                           <ListGroup.Item>\r\n                               <Row>\r\n                                   <Col>Tax</Col>\r\n                                   <Col>₹ {order.taxPrice}</Col>\r\n                               </Row>\r\n                           </ListGroup.Item>\r\n                           <ListGroup.Item>\r\n                               <Row>\r\n                                   <Col>Total</Col>\r\n                                   <Col>₹ {order.totalPrice}</Col>\r\n                               </Row>\r\n                           </ListGroup.Item>\r\n                           {!order.isPaid && (\r\n                               <ListGroup.Item>\r\n                                   {loadingPay && <Loader />}\r\n                                   {!sdkReady ? <Loader /> : (\r\n                                       <PayPalButton amount={order.totalPrice } onSuccess={successPaymentHandler} />\r\n                                   )}\r\n                               </ListGroup.Item>\r\n                           )}\r\n\r\n                           {loadingDeliver && <Loader />}\r\n\r\n                            {userInfo && userInfo.isAdmin && order.isPaid && !order.isDelivered && (\r\n                                <ListGroup.Item>\r\n                                    <Button type='button' className='btn btn-block' onClick={deliverHandler}>\r\n                                        Mark as Delivered\r\n                                    </Button>\r\n                                </ListGroup.Item>\r\n                            )}\r\n\r\n                         </ListGroup>\r\n                     </Card>\r\n                 </Col>\r\n\r\n            </Row>\r\n\r\n    </> \r\n}\r\n\r\nexport default OrdersScreens\r\n"]},"metadata":{},"sourceType":"module"}